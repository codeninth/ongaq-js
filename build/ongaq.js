!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=9)}([function(t,e,r){var n;"undefined"!=typeof window?n=window:"undefined"!=typeof self?n=self:(console.warn("Using browser-only version of superagent in non-browser environment"),n=this);var i=r(3),s=r(4),o=r(1),a=r(5),u=r(7);function h(){}var c=e=t.exports=function(t,r){return"function"==typeof r?new e.Request("GET",t).end(r):1==arguments.length?new e.Request("GET",t):new e.Request(t,r)};e.Request=_,c.getXHR=function(){if(!(!n.XMLHttpRequest||n.location&&"file:"==n.location.protocol&&n.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}throw Error("Browser-only version of superagent could not find XHR")};var l="".trim?function(t){return t.trim()}:function(t){return t.replace(/(^\s*|\s*$)/g,"")};function p(t){if(!o(t))return t;var e=[];for(var r in t)d(e,r,t[r]);return e.join("&")}function d(t,e,r){if(null!=r)if(Array.isArray(r))r.forEach(function(r){d(t,e,r)});else if(o(r))for(var n in r)d(t,e+"["+n+"]",r[n]);else t.push(encodeURIComponent(e)+"="+encodeURIComponent(r));else null===r&&t.push(encodeURIComponent(e))}function f(t){for(var e,r,n={},i=t.split("&"),s=0,o=i.length;s<o;++s)-1==(r=(e=i[s]).indexOf("="))?n[decodeURIComponent(e)]="":n[decodeURIComponent(e.slice(0,r))]=decodeURIComponent(e.slice(r+1));return n}function m(t){return/[\/+]json($|[^-\w])/.test(t)}function y(t){this.req=t,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||void 0===this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var e=this.xhr.status;1223===e&&(e=204),this._setStatusProperties(e),this.header=this.headers=function(t){for(var e,r,n,i,s=t.split(/\r?\n/),o={},a=0,u=s.length;a<u;++a)-1!==(e=(r=s[a]).indexOf(":"))&&(n=r.slice(0,e).toLowerCase(),i=l(r.slice(e+1)),o[n]=i);return o}(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),null===this.text&&t._responseType?this.body=this.xhr.response:this.body="HEAD"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function _(t,e){var r=this;this._query=this._query||[],this.method=t,this.url=e,this.header={},this._header={},this.on("end",function(){var t,e=null,n=null;try{n=new y(r)}catch(t){return(e=new Error("Parser is unable to parse the response")).parse=!0,e.original=t,r.xhr?(e.rawResponse=void 0===r.xhr.responseType?r.xhr.responseText:r.xhr.response,e.status=r.xhr.status?r.xhr.status:null,e.statusCode=e.status):(e.rawResponse=null,e.status=null),r.callback(e)}r.emit("response",n);try{r._isResponseOK(n)||(t=new Error(n.statusText||"Unsuccessful HTTP response"))}catch(e){t=e}t?(t.original=e,t.response=n,t.status=n.status,r.callback(t,n)):r.callback(null,n)})}function g(t,e,r){var n=c("DELETE",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n}c.serializeObject=p,c.parseString=f,c.types={html:"text/html",json:"application/json",xml:"text/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},c.serialize={"application/x-www-form-urlencoded":p,"application/json":JSON.stringify},c.parse={"application/x-www-form-urlencoded":f,"application/json":JSON.parse},a(y.prototype),y.prototype._parseBody=function(t){var e=c.parse[this.type];return this.req._parser?this.req._parser(this,t):(!e&&m(this.type)&&(e=c.parse["application/json"]),e&&t&&(t.length||t instanceof Object)?e(t):null)},y.prototype.toError=function(){var t=this.req,e=t.method,r=t.url,n="cannot "+e+" "+r+" ("+this.status+")",i=new Error(n);return i.status=this.status,i.method=e,i.url=r,i},c.Response=y,i(_.prototype),s(_.prototype),_.prototype.type=function(t){return this.set("Content-Type",c.types[t]||t),this},_.prototype.accept=function(t){return this.set("Accept",c.types[t]||t),this},_.prototype.auth=function(t,e,r){1===arguments.length&&(e=""),"object"==typeof e&&null!==e&&(r=e,e=""),r||(r={type:"function"==typeof btoa?"basic":"auto"});return this._auth(t,e,r,function(t){if("function"==typeof btoa)return btoa(t);throw new Error("Cannot use basic auth, btoa is not a function")})},_.prototype.query=function(t){return"string"!=typeof t&&(t=p(t)),t&&this._query.push(t),this},_.prototype.attach=function(t,e,r){if(e){if(this._data)throw Error("superagent can't mix .send() and .attach()");this._getFormData().append(t,e,r||e.name)}return this},_.prototype._getFormData=function(){return this._formData||(this._formData=new n.FormData),this._formData},_.prototype.callback=function(t,e){if(this._shouldRetry(t,e))return this._retry();var r=this._callback;this.clearTimeout(),t&&(this._maxRetries&&(t.retries=this._retries-1),this.emit("error",t)),r(t,e)},_.prototype.crossDomainError=function(){var t=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");t.crossDomain=!0,t.status=this.status,t.method=this.method,t.url=this.url,this.callback(t)},_.prototype.buffer=_.prototype.ca=_.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this},_.prototype.pipe=_.prototype.write=function(){throw Error("Streaming is not supported in browser version of superagent")},_.prototype._isHost=function(t){return t&&"object"==typeof t&&!Array.isArray(t)&&"[object Object]"!==Object.prototype.toString.call(t)},_.prototype.end=function(t){return this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=t||h,this._finalizeQueryString(),this._end()},_.prototype._end=function(){var t=this,e=this.xhr=c.getXHR(),r=this._formData||this._data;this._setTimeouts(),e.onreadystatechange=function(){var r=e.readyState;if(r>=2&&t._responseTimeoutTimer&&clearTimeout(t._responseTimeoutTimer),4==r){var n;try{n=e.status}catch(t){n=0}if(!n){if(t.timedout||t._aborted)return;return t.crossDomainError()}t.emit("end")}};var n=function(e,r){r.total>0&&(r.percent=r.loaded/r.total*100),r.direction=e,t.emit("progress",r)};if(this.hasListeners("progress"))try{e.onprogress=n.bind(null,"download"),e.upload&&(e.upload.onprogress=n.bind(null,"upload"))}catch(t){}try{this.username&&this.password?e.open(this.method,this.url,!0,this.username,this.password):e.open(this.method,this.url,!0)}catch(t){return this.callback(t)}if(this._withCredentials&&(e.withCredentials=!0),!this._formData&&"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof r&&!this._isHost(r)){var i=this._header["content-type"],s=this._serializer||c.serialize[i?i.split(";")[0]:""];!s&&m(i)&&(s=c.serialize["application/json"]),s&&(r=s(r))}for(var o in this.header)null!=this.header[o]&&this.header.hasOwnProperty(o)&&e.setRequestHeader(o,this.header[o]);return this._responseType&&(e.responseType=this._responseType),this.emit("request",this),e.send(void 0!==r?r:null),this},c.agent=function(){return new u},["GET","POST","OPTIONS","PATCH","PUT","DELETE"].forEach(function(t){u.prototype[t.toLowerCase()]=function(e,r){var n=new c.Request(t,e);return this._setDefaults(n),r&&n.end(r),n}}),u.prototype.del=u.prototype.delete,c.get=function(t,e,r){var n=c("GET",t);return"function"==typeof e&&(r=e,e=null),e&&n.query(e),r&&n.end(r),n},c.head=function(t,e,r){var n=c("HEAD",t);return"function"==typeof e&&(r=e,e=null),e&&n.query(e),r&&n.end(r),n},c.options=function(t,e,r){var n=c("OPTIONS",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n},c.del=g,c.delete=g,c.patch=function(t,e,r){var n=c("PATCH",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n},c.post=function(t,e,r){var n=c("POST",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n},c.put=function(t,e,r){var n=c("PUT",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n}},function(t,e,r){"use strict";t.exports=function(t){return null!==t&&"object"==typeof t}},function(t,e,r){var n=r(8);t.exports=function(t,e){return t.set("X-Requested-With","XMLHttpRequest"),t.set("Expires","-1"),t.set("Cache-Control","no-cache,no-store,must-revalidate,max-age=-1,private"),(n||e)&&function(t){var e=Date.now().toString();void 0!==t._query&&t._query[0]?t._query[0]+="&"+e:t._query=[e]}(t),t}},function(t,e,r){function n(t){if(t)return function(t){for(var e in n.prototype)t[e]=n.prototype[e];return t}(t)}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},n.prototype.once=function(t,e){function r(){this.off(t,r),e.apply(this,arguments)}return r.fn=e,this.on(t,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var i=0;i<n.length;i++)if((r=n[i])===e||r.fn===e){n.splice(i,1);break}return this},n.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),r=this._callbacks["$"+t];if(r)for(var n=0,i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,e);return this},n.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},n.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e,r){"use strict";var n=r(1);function i(t){if(t)return function(t){for(var e in i.prototype)t[e]=i.prototype[e];return t}(t)}t.exports=i,i.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,this},i.prototype.parse=function(t){return this._parser=t,this},i.prototype.responseType=function(t){return this._responseType=t,this},i.prototype.serialize=function(t){return this._serializer=t,this},i.prototype.timeout=function(t){if(!t||"object"!=typeof t)return this._timeout=t,this._responseTimeout=0,this;for(var e in t)switch(e){case"deadline":this._timeout=t.deadline;break;case"response":this._responseTimeout=t.response;break;default:console.warn("Unknown timeout option",e)}return this},i.prototype.retry=function(t,e){return 0!==arguments.length&&!0!==t||(t=1),t<=0&&(t=0),this._maxRetries=t,this._retries=0,this._retryCallback=e,this};var s=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];i.prototype._shouldRetry=function(t,e){if(!this._maxRetries||this._retries++>=this._maxRetries)return!1;if(this._retryCallback)try{var r=this._retryCallback(t,e);if(!0===r)return!0;if(!1===r)return!1}catch(t){console.error(t)}if(e&&e.status&&e.status>=500&&501!=e.status)return!0;if(t){if(t.code&&~s.indexOf(t.code))return!0;if(t.timeout&&"ECONNABORTED"==t.code)return!0;if(t.crossDomain)return!0}return!1},i.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this._end()},i.prototype.then=function(t,e){if(!this._fullfilledPromise){var r=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise(function(t,e){r.end(function(r,n){r?e(r):t(n)})})}return this._fullfilledPromise.then(t,e)},i.prototype.catch=function(t){return this.then(void 0,t)},i.prototype.use=function(t){return t(this),this},i.prototype.ok=function(t){if("function"!=typeof t)throw Error("Callback required");return this._okCallback=t,this},i.prototype._isResponseOK=function(t){return!!t&&(this._okCallback?this._okCallback(t):t.status>=200&&t.status<300)},i.prototype.get=function(t){return this._header[t.toLowerCase()]},i.prototype.getHeader=i.prototype.get,i.prototype.set=function(t,e){if(n(t)){for(var r in t)this.set(r,t[r]);return this}return this._header[t.toLowerCase()]=e,this.header[t]=e,this},i.prototype.unset=function(t){return delete this._header[t.toLowerCase()],delete this.header[t],this},i.prototype.field=function(t,e){if(null==t)throw new Error(".field(name, val) name can not be empty");if(this._data&&console.error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()"),n(t)){for(var r in t)this.field(r,t[r]);return this}if(Array.isArray(e)){for(var i in e)this.field(t,e[i]);return this}if(null==e)throw new Error(".field(name, val) val can not be empty");return"boolean"==typeof e&&(e=""+e),this._getFormData().append(t,e),this},i.prototype.abort=function(){return this._aborted?this:(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort"),this)},i.prototype._auth=function(t,e,r,n){switch(r.type){case"basic":this.set("Authorization","Basic "+n(t+":"+e));break;case"auto":this.username=t,this.password=e;break;case"bearer":this.set("Authorization","Bearer "+t)}return this},i.prototype.withCredentials=function(t){return null==t&&(t=!0),this._withCredentials=t,this},i.prototype.redirects=function(t){return this._maxRedirects=t,this},i.prototype.maxResponseSize=function(t){if("number"!=typeof t)throw TypeError("Invalid argument");return this._maxResponseSize=t,this},i.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},i.prototype.send=function(t){var e=n(t),r=this._header["content-type"];if(this._formData&&console.error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()"),e&&!this._data)Array.isArray(t)?this._data=[]:this._isHost(t)||(this._data={});else if(t&&this._data&&this._isHost(this._data))throw Error("Can't merge these send calls");if(e&&n(this._data))for(var i in t)this._data[i]=t[i];else"string"==typeof t?(r||this.type("form"),r=this._header["content-type"],this._data="application/x-www-form-urlencoded"==r?this._data?this._data+"&"+t:t:(this._data||"")+t):this._data=t;return!e||this._isHost(t)?this:(r||this.type("json"),this)},i.prototype.sortQuery=function(t){return this._sort=void 0===t||t,this},i.prototype._finalizeQueryString=function(){var t=this._query.join("&");if(t&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+t),this._query.length=0,this._sort){var e=this.url.indexOf("?");if(e>=0){var r=this.url.substring(e+1).split("&");"function"==typeof this._sort?r.sort(this._sort):r.sort(),this.url=this.url.substring(0,e)+"?"+r.join("&")}}},i.prototype._appendQueryString=function(){console.trace("Unsupported")},i.prototype._timeoutError=function(t,e,r){if(!this._aborted){var n=new Error(t+e+"ms exceeded");n.timeout=e,n.code="ECONNABORTED",n.errno=r,this.timedout=!0,this.abort(),this.callback(n)}},i.prototype._setTimeouts=function(){var t=this;this._timeout&&!this._timer&&(this._timer=setTimeout(function(){t._timeoutError("Timeout of ",t._timeout,"ETIME")},this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout(function(){t._timeoutError("Response timeout of ",t._responseTimeout,"ETIMEDOUT")},this._responseTimeout))}},function(t,e,r){"use strict";var n=r(6);function i(t){if(t)return function(t){for(var e in i.prototype)t[e]=i.prototype[e];return t}(t)}t.exports=i,i.prototype.get=function(t){return this.header[t.toLowerCase()]},i.prototype._setHeaderProperties=function(t){var e=t["content-type"]||"";this.type=n.type(e);var r=n.params(e);for(var i in r)this[i]=r[i];this.links={};try{t.link&&(this.links=n.parseLinks(t.link))}catch(t){}},i.prototype._setStatusProperties=function(t){var e=t/100|0;this.status=this.statusCode=t,this.statusType=e,this.info=1==e,this.ok=2==e,this.redirect=3==e,this.clientError=4==e,this.serverError=5==e,this.error=(4==e||5==e)&&this.toError(),this.created=201==t,this.accepted=202==t,this.noContent=204==t,this.badRequest=400==t,this.unauthorized=401==t,this.notAcceptable=406==t,this.forbidden=403==t,this.notFound=404==t,this.unprocessableEntity=422==t}},function(t,e,r){"use strict";e.type=function(t){return t.split(/ *; */).shift()},e.params=function(t){return t.split(/ *; */).reduce(function(t,e){var r=e.split(/ *= */),n=r.shift(),i=r.shift();return n&&i&&(t[n]=i),t},{})},e.parseLinks=function(t){return t.split(/ *, */).reduce(function(t,e){var r=e.split(/ *; */),n=r[0].slice(1,-1);return t[r[1].split(/ *= */)[1].slice(1,-1)]=n,t},{})},e.cleanHeader=function(t,e){return delete t["content-type"],delete t["content-length"],delete t["transfer-encoding"],delete t.host,e&&(delete t.authorization,delete t.cookie),t}},function(t,e){function r(){this._defaults=[]}["use","on","once","set","query","type","accept","auth","withCredentials","sortQuery","retry","ok","redirects","timeout","buffer","serialize","parse","ca","key","pfx","cert"].forEach(function(t){r.prototype[t]=function(){return this._defaults.push({fn:t,arguments:arguments}),this}}),r.prototype._setDefaults=function(t){this._defaults.forEach(function(e){t[e.fn].apply(t,e.arguments)})},t.exports=r},function(t,e){t.exports=function(){for(var t=3,e=document.createElement("b"),r=e.all||[];e.innerHTML="\x3c!--[if gt IE "+ ++t+"]><i><![endif]--\x3e",r[0];);return t>4?t:document.documentMode}()},function(t,e,r){"use strict";r.r(e);var n={};r.r(n),r.d(n,"empty",function(){return rt}),r.d(n,"note",function(){return ut}),r.d(n,"arpeggio",function(){return ct}),r.d(n,"pan",function(){return dt});const i=window.innerWidth,s=window.innerHeight,o=t=>{const e=t.listener;return e.forwardX?(e.forwardX.setValueAtTime(0,t.currentTime),e.forwardY.setValueAtTime(0,t.currentTime),e.forwardZ.setValueAtTime(-1,t.currentTime),e.upX.setValueAtTime(0,t.currentTime),e.upY.setValueAtTime(1,t.currentTime),e.upZ.setValueAtTime(0,t.currentTime)):e.setOrientation(0,0,-1,0,1,0),e.positionX?(e.positionX.value=i/2,e.positionY.value=s/2,e.positionZ.value=300):e.setPosition(i/2,s/2,300),t},a=o(new(window.AudioContext||window.webkitAudioContext)),u=(new Date).getTime(),h=(()=>{let t=window.navigator.userAgent;return["iPhone","iPad","iPod","Android"].some(e=>-1!==t.indexOf(e))?"low":"middle"})();var c={context:a,originTime:u,powerMode:h,SUPPRESSION:.5,toAudioBuffer:({src:t,length:e})=>!(!t||!e)&&new Promise((r,n)=>{try{let i=new ArrayBuffer(e),s=new Uint8Array(i);for(let r=0;r<e;r++)s[r]=t.charCodeAt(r);a.decodeAudioData(i,t=>t?r(t):n(),n)}catch(t){return n(t)}}),createOfflineContext:({seconds:t})=>o(new OfflineAudioContext(2,44100*t,44100)),spaceWidth:i,spaceHeight:s};var l="https://api.ongaqjs.com";var p=new Map([["C",1],["C#",2],["Db",2],["D",3],["D#",4],["Eb",4],["E",5],["F",6],["F#",7],["Gb",7],["G",8],["G#",9],["Ab",9],["A",10],["A#",11],["Bb",11],["B",12]]);const d=/^([A-Z])+([1-4])+(b|#)?$/;var f=(t="")=>{if(!1===d.test(t))return t;{const e=d.exec(t);return e&&p.get(e[1])?`${e[2]}$${p.get(e[1]+(e[3]||""))}`:t}};var m=new Map([["kick","1$1"],["kick2","2$1"],["hihat","1$2"],["hihat2","2$2"],["snare","1$3"],["snare2","2$3"],["tom","1$4"],["tom2","2$4"],["side","1$9"],["side2","2$9"],["cymbal","1$12"],["cymbal2","2$12"]]),y=(t="")=>m.get(t)||t;const _=window.sessionStorage,g=(()=>{if(!_)return!1;let t=!1;try{_.setItem("_test","1"),t=!0}catch(t){return!1}finally{t&&_.removeItem("_test")}return t})();var b={set:(t,e)=>!(!g||"string"!=typeof t)&&_.setItem(`cache.${t}`,e),get:t=>!(!g||"string"!=typeof t)&&_.getItem(`cache.${t}`),purge:t=>!(!g||"string"!=typeof t)&&_.removeItem(`cache.${t}`)},w=r(0),v=r.n(w),T=r(2),x=r.n(T);let E=new Map;const A=t=>{try{return t=(t=t.split("|")).map(t=>{const e=t.split("$");return[e[0],JSON.parse(e[1])]}),new Map(t)}catch(t){return null}};var M=new class{constructor(){this.soundNameMap=new Map}getSoundNameMap(){try{const t=A(b.get("soundNameMap"));return t.forEach(t=>{t.id<2e4?t.type="scalable":t.id<3e4?t.type="percussive":t.type="scalable",delete t.id}),t}catch(t){return null}}set({api_key:t}){this.api_key=t;let e=b.get("soundNameMap");if(e)try{this.soundNameMap=A(e)}catch(t){throw b.purge("soundNameMap"),new Error("Cannot download instrumental master data.")}else v.a.get(`${l}/soundnamemap/`).then(t=>{if(!t||200!==t.body.statusCode)throw new Error("Cannot download instrumental master data.");this.soundNameMap=new Map(t.body.data);const e=t.body.data.map(t=>`${t[0]}$${JSON.stringify(t[1])}`).join("|");b.set("soundNameMap",e)}).catch(()=>{throw new Error("Cannot download instrumental master data.")})}async import({sound:t}){return new Promise((e,r)=>{if(E.get(t))return e();E.set(t,[]),v.a.get(`${l}/sounds/`).query({sound:t,api_key:this.api_key}).set("Content-Type","application/json").use(x.a).then(n=>{let i=n.body.sounds[0];if(!i||"OK"!==i.status)return r();let s="string"==typeof i.data?JSON.parse(i.data):i.data,o=Object.keys(s.note),a=new Map,u=0;o.forEach(async n=>{let i=s.note[n];try{let s=await c.toAudioBuffer({src:i.src,length:i.length});a.set(n,s),++u===o.length&&(o=null,E.set(t,a),e())}catch(e){E.has(t)&&E.delete(t),r()}})}).catch(()=>{E.has(t)&&E.delete(t),r(`Cannot load sound resources. There are 4 possible reasons: 1) [ ${t} ] is invalid as an instrumental name. 2) [ ${t} ] is not free and you don't have a pro license. 3) Your remote IP address or hostname is not registered as an authorized origin at dashboard. 4) [ ${this.api_key} ] is not a valid API key.`)})})}ship({sound:t,key:e}){if(!t||!E.get(t))return!1;const r=this.soundNameMap.get(t)&&this.soundNameMap.get(t).id;return e?(r<2e4?e=f(e):r<3e4?e=y(e):r<6e4&&(e=f(e)),Array.isArray(e)?e.map(e=>E.get(t).get(e)).filter(t=>t):"string"==typeof e?[E.get(t).get(e)]:[]):E.get(t)}};var k={BPM:120,MIN_BPM:60,MAX_BPM:180,MEASURE:4,VOLUME:.5,NOTE_VOLUME:.5,BEATS_IN_MEASURE:16,PREFETCH_SECOND:"middle"===c.powerMode?.3:2,WAV_MAX_SECONDS:45};let O=new Float32Array(6);var P={toInt:(t,e={})=>{let r="number"==typeof e.max?e.max:Number.POSITIVE_INFINITY,n="number"==typeof e.min?e.min:Number.NEGATIVE_INFINITY,i="number"==typeof e.min?e.base:10,s=parseInt(t,i);return!Number.isNaN(s)&&s<=r&&s>=n&&s},getUUID:t=>{let e,r,n="";for(e=0;e<32;e++)r=16*Math.random()|0,8!=e&&12!=e&&16!=e&&20!=e||(n+="-"),n+=(12==e?4:16==e?3&r|8:r).toString(16);return"number"==typeof t&&(n=n.slice(0,t)),n},getWaveShapeArray:t=>{let e=t&&t>=0&&t<=1?t:k.NOTE_VOLUME;return O[0]=1*e*c.SUPPRESSION,O[1]=.8*e*c.SUPPRESSION,O[2]=.5*e*c.SUPPRESSION,O[3]=.3*e*c.SUPPRESSION,O[4]=.1*e*c.SUPPRESSION,O[5]=0,O},toKeyList:(t,e,r)=>!!t&&(Array.isArray(t)?t:Array.isArray(t.list)?t.list:"function"==typeof t?e>=0&&t(e,r):"string"==typeof t&&[t]),toLength:(t,e,r)=>{switch(typeof t){case"number":return t;case"function":return e>=0&&t(e,r);default:return!1}}};var C=class{constructor(t){this.name=t.name,this.isClass=t.isClass,this.active=!1!==t.active,this.makeMethod=t.makeMethod,this.make=(t=>this.isClass?new this.makeMethod(t):this.makeMethod(t)),this.pool=[]}allocate(t){let e=void 0;return 0===this.pool.length||!1===this.active?e=this.make(t):(e=this.pool.pop())||(e=this.make(t)),e}retrieve(t){this.pool.push(t)}flush(){this.pool=[]}};var S=new C({makeMethod:()=>({}),active:!0,isClass:!1,name:"Element"});var I=new C({makeMethod:t=>t.createGain(),active:!0,isClass:!1,name:"GainNode"});var R=class{constructor(){this.pool=new Map}get(t){return this.pool.get(t)}set(t,e){return this.pool.set(t,e)}flush(){this.pool.forEach(t=>{t.disconnect&&t.disconnect(),t=null}),this.pool=new Map}};var N=new R,L=(t="")=>!!m.get(t);const $=new Map,B=new Map;let D=[2,3,4,5].map(t=>4*t+c.context.currentTime);D.forEach(t=>{$.set(t,[]),B.set(t,[])});const q=t=>{const e=t+4;return(D=D.slice(1)).push(e),$.set(e,[]),B.set(e,[]),e};var j=({buffer:t,volume:e},r)=>{r instanceof(window.AudioContext||window.webkitAudioContext)&&(t=>{if(D[0]>t.currentTime)return!1;for(let e=0,r=D.length;e<r;e++)D[e]>t.currentTime||($.get(D[e])&&$.get(D[e]).forEach(e=>{e.disconnect(),e.context===t&&I.retrieve(e)}),B.get(D[e])&&B.get(D[e]).forEach(t=>{t.disconnect()}),$.delete(D[e]),B.delete(D[e]),q(D[r-1]))})(r);let n=M.ship(t);if(!n)return!1;let i=r.createBufferSource();i.length=t.length,i.buffer=n[0];let s=I.allocate(r);if(s.gain.setValueAtTime(c.SUPPRESSION*("number"==typeof e&&e>=0&&e<1?e:k.NOTE_VOLUME),0),!L(t.key)&&s.gain.setValueCurveAtTime(P.getWaveShapeArray(e),t.startTime+t.length-(.03<t.length?.03:.6*t.length),.03<t.length?.03:.6*t.length),i.connect(s),i.start(t.startTime),!(r instanceof(window.AudioContext||window.webkitAudioContext)))return s;for(let e=0,r=D.length;e<r;e++){if(t.startTime+t.length+.1<D[e]){$.get(D[e]).push(s),B.get(D[e]).push(i);break}if(e===r-1){const e=q(t.startTime+t.length+.1);$.get(e).push(s),B.get(e).push(i)}}return s};var U=({delayTime:t},e)=>{let r=e.createDelay();return r.delayTime.value=t,r};var H=({x:t},e)=>{const r=e.createPanner();r.refDistance=1e3,r.maxDistance=1e4,r.coneOuterGain=1;const n=[1,0,0];r.orientationX?(r.orientationX.setValueAtTime(n[0],e.currentTime),r.orientationY.setValueAtTime(n[1],e.currentTime),r.orientationZ.setValueAtTime(n[2],e.currentTime)):r.setOrientation(...n);const i=(t=>"number"==typeof t&&t>=-90&&t<=90?t:0)(t),s=[c.spaceWidth/2+1e3/c.spaceWidth*c.spaceWidth/90*i/52,c.spaceHeight/2,299];return r.positionX?(r.positionX.setValueAtTime(s[0],e.currentTime),r.positionY.setValueAtTime(s[1],e.currentTime),r.positionZ.setValueAtTime(s[2],e.currentTime)):r.setPosition(...s),r};var X=(t,e,r)=>{switch(t){case"audiobuffer":return j(e,r||c.context);case"delay":return U(e,r||c.context);case"panner":return H(e,r||c.context);default:return null}};var V=new R;var G=new R;var z=new R;var F=new Map([["",[4,3]],["M7",[4,3,4]],["7",[4,3,3]],["m",[3,4]],["m7",[3,4,3]],["mM7",[3,4,4]],["6",[4,3,2]],["m6",[3,4,2]],["dim",[3,3,3]],["aug",[4,4]],["sus4",[5,2]],["7sus4",[5,2,3]],["7-5",[4,2,4]],["m7-5",[3,3,4]],["M7+5",[4,4,3]],["M9",[4,3,4,3]],["m9",[3,4,3,4]],["m11",[3,4,3,7]],["6(9)",[4,3,2,5]],["m6(9)",[3,4,2,5]],["7(b9)",[4,3,3,3]],["9",[4,3,3,4]],["7(9)",[4,3,3,4]],["7(#9)",[4,3,3,5]],["11",[4,3,3,7]],["7(#11)",[4,3,3,8]],["13",[4,3,3,11]],["7(13)",[4,3,3,11]]]),W="1.1.0";const K=()=>{I.flush(),S.flush(),N.flush(),V.flush(),G.flush(),z.flush()};var Y=class{constructor(t){this._init(t)}add(t){return new Promise(async(e,r)=>{if("function"!=typeof t.loadSound)return r("not a Part object");t.bpm=t.bpm||this.bpm,this.parts.set(t.id,t);try{await t.loadSound();let n=!0;this.parts.forEach(t=>{(t._isLoading||t._loadingFailed)&&(n=!1)}),n&&(this.allPartsLoadedOnce||this.onReady&&this.onReady(),this.allPartsLoadedOnce=!0),e()}catch(t){this.isError||(this.onError&&this.onError(t),this.isError=!0),r(t)}})}prepare({sound:t}){return M.import({sound:t})}start(){return!this.isPlaying&&0!==this.parts.size&&(this.isPlaying=!0,this.commonGain||(this.commonGain=this._getCommonGain(c.context)),this.parts.forEach(t=>{t._putTimerRight(c.context.currentTime)}),this._scheduler=window.setInterval(()=>{this._routine(c.context,t=>{this._connect(t)})},"middle"===c.powerMode?50:200),!1)}sound(t={}){if(!t.key||!t.sound)return!1;try{const e=Array.isArray(t.key)?t.key:[t.key],r=t.step>0?t.step:0,n=e.map((e,n)=>X("audiobuffer",{buffer:{sound:t.sound,length:t.second>0?t.second:1.5,key:e,startTime:c.context.currentTime+.1+n*r},volume:1},c.context)).filter(t=>t),i=this._getCommonGain(c.context);n.map(t=>t.connect(i))}catch(t){return!1}}record(t={}){if(this.isPlaying)throw"cannot start recording while playing sounds";if(this.isRecording)throw"cannot start recording while other recording process ongoing";if(!window.OfflineAudioContext)throw"OfflineAudioContext is not supported";return!this.isPlaying&&0!==this.parts.size&&new Promise(async(e,r)=>{try{this.isRecording=!0,K();const n=[];this.parts.forEach(e=>{e._reset(),e._putTimerRight(0);const r="number"==typeof t.maxLap&&t.maxLap>0?t.maxLap:e.maxLap;n.push(r*e.measure*e._beatsInMeasure*e._secondsPerBeat)});const i=(()=>"number"==typeof t.seconds&&t.seconds>=1&&t.seconds<=k.WAV_MAX_SECONDS?t.seconds:Math.max(n)<1?1:Math.max(n)<k.WAV_MAX_SECONDS?Math.max(n):k.WAV_MAX_SECONDS)(),s="number"==typeof t.margin&&t.margin>=1?t.margin:0,o=c.createOfflineContext({seconds:i+s<k.WAV_MAX_SECONDS?i+s:k.WAV_MAX_SECONDS}),a=this._getCommonGain(o);this._routine(o,t=>{t.terminal.length>0&&t.terminal[t.terminal.length-1].forEach(t=>{t&&t.connect&&t.connect(a)}),t.initialize(),S.retrieve(t)});const u=await o.startRendering();this.isRecording=!1,e(u)}catch(t){this.isRecording=!1,r(t)}finally{K()}})}pause(){return!!this.isPlaying&&(this._scheduler&&(window.clearInterval(this._scheduler),this._scheduler=null),this.isPlaying=!1,this._removeCommonGain(),!1)}find(...t){let e=[];return 0===t.length?e:(this.parts.forEach(r=>{t.every(t=>r.tags.includes(t))&&e.push(r)}),e)}get params(){let t=!1;return this.parts.forEach(e=>{e._isLoading&&(t=!0)}),{loading:t,isPlaying:this.isPlaying,originTime:c.originTime,currentTime:c.context.currentTime,volume:this.volume}}get context(){return c.context}get constants(){return{DRUM_NOTE:m,ROOT:p,SCHEME:F}}get soundNameMap(){return M.getSoundNameMap()}get version(){return W}set volume(t){if("number"!=typeof t||t<0||t>100)return!1;this._volume=t/100*c.SUPPRESSION,this.commonGain&&this.commonGain.gain.setValueAtTime(this._volume,c.context.currentTime+.01)}get volume(){return 100*this._volume/c.SUPPRESSION}set bpm(t){let e=P.toInt(t,{max:k.MAX_BPM,min:k.MIN_BPM});if(!e)return!1;this._bpm=e,this.parts.forEach(t=>{t.bpm=e})}get bpm(){return this._bpm}_init({api_key:t,volume:e,bpm:r,onReady:n,onError:i}){this.parts=new Map,this.isPlaying=!1,this.isRecording=!1,this.allPartsLoadedOnce=!1,this.volume=e||k.VOLUME,this._nextZeroTime=0,this.bpm=r||k.BPM,"low"===c.powerMode&&window.addEventListener("blur",()=>{this.pauseScheduling()}),this.onReady="function"==typeof n&&n,this.onError="function"==typeof i&&i,this.isError=!1,this._routine=this._routine.bind(this),M.set({api_key:t})}_getCommonGain(t){const e=t.createDynamicsCompressor();e.connect(t.destination);const r=t.createGain();return r.connect(e),r.gain.setValueAtTime(this._volume,0),r}_removeCommonGain(){return!!this.commonGain&&(this.commonGain.gain.setValueAtTime(0,0),this.commonGain=null,!1)}_connect(t){return!(!t||!this.isPlaying||(t.terminal.length>0&&t.terminal[t.terminal.length-1].forEach(t=>{t.connect(this.commonGain)}),t.initialize(),S.retrieve(t),1))}_routine(t,e){let r,n;return this.parts.forEach(e=>{(n=e.collect(t))&&n.length>0&&(r=(r=r||[]).concat(n))}),!(!r||0===r.length||(r.forEach(e),1))}};var Z=(t,e)=>{if(0===t||t<=-13||t>=13)return e;if(!Array.isArray(e))return[];let r=e.map(t=>t.split("$").map(t=>+t));return r=r.map(e=>e[1]+t<=12&&e[1]+t>0?`${e[0]}$${e[1]+t}`:t<0&&e[1]+t<=0?e[0]>1&&`${e[0]-1}$${12+e[1]+t}`:t>0&&e[1]+t>12&&(e[0]<4?`${e[0]+1}$${-12+e[1]+t}`:void 0)).filter(t=>t)};class J{constructor(t,e={}){this._init(t,e)}shift(t){return new J(this.name,{octave:this.defaultOctave,key:Z(t,this.originalKey)})}octave(t){if(0===t||"number"!=typeof t||Number.isNaN(t))return this;let e=this.originalKey.map(t=>t.split("$").map(t=>+t));return e=e.map(e=>{if(e[0]+t<=4&&e[0]+t>0)return`${e[0]+t}$${e[1]}`}).filter(t=>t),new J(this.name,{octave:this.defaultOctave,key:e})}reverse(){let t=this.originalKey.reverse();return new J(this.name,{octave:this.defaultOctave,key:t})}slice(t,e){if(Number.isNaN(t))return this;let r=this.originalKey.slice(t,e);return new J(this.name,{octave:this.defaultOctave,key:r})}rotate(){if(!this.key)return this;let t=this.originalKey.map(t=>t),e=t.splice(-1,1)[0],r=t.splice(0,1)[0],n=e.split("$").map(t=>+t),i=r.split("$").map(t=>+t),s=i[1],o=(()=>i[1]>n[1]?n[0]:i[1]+n[1]>12?n[0]+1:n[0])();if(o>4)return this;let a=this.key.map(t=>t).splice(1);return a.push(`${o}$${s}`),new J(this.name,{octave:this.defaultOctave,key:a})}get route(){return Array.isArray(this.key)&&this.key[0]}get name(){return this.rootLabel+this.schemeLabel}_init(t,e){if(this.active=!0,this.defaultShift=e.defaultShift||0,this.defaultOctave=e.octave>0&&e.octave<=4?e.octave:2,"string"!=typeof t)return this.active=!1,!1;let r=(()=>{let e,r,n=[];return p.forEach((i,s)=>{(n=t.match(new RegExp("^"+s)))&&n[0]===s&&(e=i,r=s)}),{root:e,rootLabel:r}})();if(!r.root)return this.active=!1,!1;let n=(t=>{let e,r;return F.forEach((n,i)=>{i===t&&(e=n,r=i)}),{scheme:e,schemeLabel:r}})(t.replace(r.rootLabel,""));if(!n.scheme)return this.active=!1,!1;let i=(()=>{if(e.key)return e.key;let t=[],i=r.root,s=this.defaultOctave;return t.push(`${s}$${i}`),n.scheme.forEach(e=>{let r=i+e>12;i=r?i+e-12:i+e,(s=r?s+1:s)<=4&&t.push(`${s}$${i}`)}),t})();this.rootLabel=r.rootLabel,this.defaultOctave=e.octave,this.scheme=n.scheme,this.schemeLabel=n.schemeLabel,this.originalKey=Z(this.defaultShift,i.map(t=>t)),this.key=Z(this.defaultShift,i)}}var Q=J,tt={empty:10,note:140,notelist:145,arpeggio:240,pan:340};const et=tt.empty;var rt=()=>()=>{const t=S.allocate();return t.priority=et,t.terminal=[],t._inits=[],t.initialize=(()=>{t._inits.forEach(t=>t())}),t};const nt=(t,e={},r=!0)=>{let n;switch(typeof t){case"string":return"function"==typeof e.string&&e.string(t);case"object":return Array.isArray(t)&&"function"==typeof e.array?e.array(t):"function"==typeof e.object&&e.object(t);case"number":return"function"==typeof e.number?e.number(t):t;case"boolean":return t;case"function":return n=t(...e._arguments),"function"==typeof e._next&&(n=e._next(n)),r?nt(n,e,!1):n;default:return e.default?"function"==typeof e.default?e.default(e._arguments):e.default:t}};var it=nt;var st=(t,e)=>it(t,{_arguments:[e.beatIndex,e.measure,e.attachment],object:t=>Array.isArray(t)&&t.includes(e.beatIndex),number:t=>t===e.beatIndex,default:!0});const ot=tt.note,at=[4,32,64];var ut=(t={},e={},r)=>{if(!st(t.active,e))return!1;const n=it(t.key,{_arguments:[e.beatIndex,e.measure,e.attachment],string:t=>[t],object:t=>t.key,array:t=>t});if(!n||0===n.length)return!1;const i=it(t.length,{_arguments:[e.beatIndex,e.measure,e.attachment],number:t=>t,array:t=>t,default:(()=>{const t=M.getSoundNameMap().get(e.sound);return t?t.tag.includes("riff")?at[2]:"percussive"===t.type?at[1]:at[0]:0})()});if(!i)return!1;let s=it(t.volume,{_arguments:[e.beatIndex,e.measure,e.attachment],number:t=>t>0&&t<100?t/100:0===t?-1:100===t?.999:null,string:()=>!1,object:()=>!1,array:()=>!1});return-1!==s&&(t=>{const o=n.map((t,n)=>X("audiobuffer",{buffer:{sound:e.sound,length:(Array.isArray(i)?"number"==typeof i[n]?i[n]:L(t)?at[1]:at[0]:i)*e.secondsPerBeat,key:t,startTime:e.beatTime},volume:s},r));return t.terminal[0]=t.terminal[0]||[],t.terminal[0].push(...o),t.priority=ot,t.footprints=t.footprints||{},t.footprints._noteLength=(Array.isArray(i)?"number"==typeof i[0]?i[0]:at:i)*e.secondsPerBeat,t.footprints._beatTime=e.beatTime,t})};const ht=tt.arpeggio;var ct=(t={},e={},r)=>{if(!st(t.active,e))return!1;const n=it(t.step,{number:t=>t<16?t:1,_arguments:[e.beatIndex,e.measure,e.attachment],default:0});if(!n)return!1;const i=it(t.range,{number:t=>t>0&&t<9?t:3,_arguments:[e.beatIndex,e.measure,e.attachment],default:3}),s=r instanceof(window.AudioContext||window.webkitAudioContext)?`${n}_${i}_${e.secondsPerBeat}`:`offline_${n}_${i}_${e.secondsPerBeat}`;return z.get(s)?z.get(s):(z.set(s,((t,e,r,n)=>i=>{if(n instanceof OfflineAudioContext||0===i.terminal.length||0===i.terminal[i.terminal.length-1].length)return i;let s=[];for(let o,a=0,u=i.terminal[i.terminal.length-1].length;a<u;a++)o=r*(a<=e?a:e)*t,n instanceof(window.AudioContext||window.webkitAudioContext)?(G.get(o)||G.set(o,X("delay",{delayTime:o},n)),s.push(G.get(o))):(G.get(`offline_${o}`)||G.set(`offline_${o}`,X("delay",{delayTime:o},n)),s.push(G.get(`offline_${o}`)));let o=n.createGain();return o.gain.setValueAtTime(1,0),o.gain.setValueCurveAtTime(P.getWaveShapeArray(0),i.footprints._beatTime+i.footprints._noteLength-.02,.02),s.forEach(t=>{t.connect(o)}),i.terminal.push([o]),i.terminal[i.terminal.length-2].forEach((t,e)=>{t.connect(s[e<=s.length-1?e:s.length-1])}),s=s.slice(0,i.terminal[i.terminal.length-2].length),i.priority=ht,i})(n,i,e.secondsPerBeat,r)),z.get(s))};const lt=tt.pan,pt=(t,e)=>r=>{if(0===r.terminal.length)return r;N.get(t)||N.set(t,X("panner",{x:t},e));const n=N.get(t);return r.terminal.push([n]),r.terminal[r.terminal.length-2].forEach(t=>{t.connect(n)}),r.priority=lt,r};var dt=(t={},e={},r)=>{if(!st(t.active,e))return!1;const n=it(t.x,{string:t=>P.toInt(t,{max:90,min:-90}),number:t=>P.toInt(t,{max:90,min:-90}),_arguments:[e.beatIndex,e.measure,e.attachment],_next:t=>P.toInt(t,{max:90,min:-90}),default:0});return!!n&&(r instanceof(window.AudioContext||window.webkitAudioContext)?V.get(n)?V.get(n):(V.set(n,pt(n,r)),V.get(n)):V.get(`offline_${n}`)?V.get(`offline_${n}`):(V.set(`offline_${n}`,pt(n,r)),V.get(`offline_${n}`)))};class ft{constructor(t={}){this.sound=t.sound,this.id=t.id||P.getUUID(),this.tags=Array.isArray(t.tags)?t.tags:[],this.bpm=t.bpm,this.measure="number"==typeof t.measure&&t.measure>=0?t.measure:k.MEASURE,this.onLoaded=t&&"function"==typeof t.onLoaded&&t.onLoaded,this.willMakeLap=t&&"function"==typeof t.willMakeLap&&t.willMakeLap,this.maxLap="number"==typeof t.maxLap&&t.maxLap>=0?t.maxLap:1/0,this.repeat=!1!==t.repeat,this._isLoading=!1,this._beatsInMeasure="number"==typeof t.beatsInMeasure&&t.beatsInMeasure>=0?t.beatsInMeasure:k.BEATS_IN_MEASURE,this._currentBeatIndex=0,this._nextBeatTime=0,this._lap=0,this._attachment={},this.default={},this.default.active=!1!==t.active,this.active=!1,this.mute=!!t.mute,this._putTimerRight(c.context.currentTime),this.collect=this.collect.bind(this)}add(t){return!(!t||!t.priority||-1===t.priority)&&(this.filters=this.filters||[],this.filters.push(t),this.filters.sort((t,e)=>t.priority>e.priority?1:t.priority<e.priority?-1:0),this._generator=(t=>{this._targetBeat=this._targetBeat||{},this._targetBeat.sound=this.sound,this._targetBeat.measure=Math.floor(this._currentBeatIndex/this._beatsInMeasure),this._targetBeat.beatIndex=this._currentBeatIndex%this._beatsInMeasure,this._targetBeat.beatTime=this._nextBeatTime,this._targetBeat.secondsPerBeat=this._secondsPerBeat,this._targetBeat.lap=this._lap,this._targetBeat.attachment=this._attachment;let e=!1,r=[];return this.filters.forEach(({type:i,params:s})=>{if(!Object.hasOwnProperty.call(n,i)||"note"!==i&&"notelist"!==i&&!e)return!1;const o=n[i](s,this._targetBeat,t);o&&("note"!==i&&"notelist"!==i||(e=!0),r.push(o))}),r.reduce((t,e)=>e(t),rt()())}),this._generator=this._generator.bind(this),!1)}attach(t={}){this._attachment=Object.assign(this._attachment,t)}collect(t){let e,r=t.currentTime+k.PREFETCH_SECOND+(t instanceof(window.AudioContext||window.webkitAudioContext)?0:k.WAV_MAX_SECONDS);for(;this._nextBeatTime-r>0&&this._nextBeatTime-r<k.PREFETCH_SECOND;)r+=k.PREFETCH_SECOND;for(this._endTime&&this._endTime<r&&this._shutdown();this.active&&this._nextBeatTime<r;){let r=!this.mute&&this._generator(t);r&&(e=(e=e||[]).concat(r)),this._nextBeatTime+=this._secondsPerBeat,this._currentBeatIndex+1>=this.measure*this._beatsInMeasure?(this._currentBeatIndex=0,this._lap++,"function"==typeof this.willMakeLap&&this.willMakeLap({nextLap:this._lap,meanTime:this._nextBeatTime}),this._lap>this.maxLap&&(this.repeat?this.resetLap():this.out())):this._currentBeatIndex++}return"function"==typeof this._syncRequest&&(this._syncRequest(),this._syncRequest=null),e}syncTo(t){if(t instanceof ft==!1)return!1;t._syncRequest=(()=>{this._currentBeatIndex=(()=>{const e=parseInt(t._currentBeatIndex/(t.measure*t._beatsInMeasure),10);return t._currentBeatIndex-e*(t.measure*t._beatsInMeasure)})(),this._nextBeatTime=t._nextBeatTime})}changeSound({sound:t}){return new Promise(async(e,r)=>{try{await M.import({sound:t}),this.sound=t,e()}catch(t){r(t)}})}detach(t){"string"==typeof t?delete this._attachment[t]:this._attachment={}}in(t){if("number"!=typeof t)throw new Error("assign a number for the first argument for Part.in( )");return!this.active&&(this._meanTime=t,this._nextBeatTime=t,this.default.active=!0,this.active=!0,!1)}async loadSound(){return this._isLoading=!0,new Promise(async(t,e)=>{try{await M.import({sound:this.sound}),this._isLoading=!1,this.active=this.default.active,this.onLoaded&&this.onLoaded(),t()}catch(t){this._isLoading=!1,this._loadingFailed=!0,e(t)}})}out(t,e=!1){return!!this.active&&(this._endTime?e&&t&&(this._endTime=t):t?this._endTime=t:this._shutdown(),!1)}tag(...t){this.tags=Array.isArray(this.tags)?this.tags:[],t.forEach(t=>{this.tags.includes(t)||this.tags.push(t)})}removeTag(...t){this.tags=Array.isArray(this.tags)?this.tags:[],this.tags=this.tags.filter(e=>!t.includes(e))}resetLap(){this._lap=0}set bpm(t){let e=P.toInt(t,{max:k.MAX_BPM,min:k.MIN_BPM});e&&(this._bpm=e)}get bpm(){return this._bpm}set mute(t){"boolean"==typeof t&&(this._mute=t)}get mute(){return this._mute}_shutdown(){if(!this.active)return!1;this._meanTime=0,this._endTime=0,this._nextBeatTime=0,this.active=!1}_putTimerRight(t){if(!this.active||"number"!=typeof t||t<0)return!1;this._nextBeatTime=t}_reset(){this._lap=0,this._currentBeatIndex=0}get _secondsPerBeat(){return 60/this._bpm/8}}var mt=ft;var yt=class{constructor(t){this.init(t)}init(t={type:null}){this.type="string"==typeof t.type?t.type:"note",this.params=t,this.priority=tt[this.type]||-1,delete t.type}};window.Ongaq=window.Ongaq||Y,window.Chord=window.Chord||Q,window.Part=window.Part||mt,window.Filter=window.Filter||yt;e.default={Ongaq:Y,Chord:Q,Part:mt,Filter:yt}}]);