!function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=9)}([function(t,e,r){var i;"undefined"!=typeof window?i=window:"undefined"!=typeof self?i=self:(console.warn("Using browser-only version of superagent in non-browser environment"),i=this);var n=r(3),s=r(4),o=r(1),a=r(5),u=r(7);function h(){}var c=e=t.exports=function(t,r){return"function"==typeof r?new e.Request("GET",t).end(r):1==arguments.length?new e.Request("GET",t):new e.Request(t,r)};e.Request=_,c.getXHR=function(){if(!(!i.XMLHttpRequest||i.location&&"file:"==i.location.protocol&&i.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}throw Error("Browser-only version of superagent could not find XHR")};var l="".trim?function(t){return t.trim()}:function(t){return t.replace(/(^\s*|\s*$)/g,"")};function p(t){if(!o(t))return t;var e=[];for(var r in t)d(e,r,t[r]);return e.join("&")}function d(t,e,r){if(null!=r)if(Array.isArray(r))r.forEach(function(r){d(t,e,r)});else if(o(r))for(var i in r)d(t,e+"["+i+"]",r[i]);else t.push(encodeURIComponent(e)+"="+encodeURIComponent(r));else null===r&&t.push(encodeURIComponent(e))}function f(t){for(var e,r,i={},n=t.split("&"),s=0,o=n.length;s<o;++s)-1==(r=(e=n[s]).indexOf("="))?i[decodeURIComponent(e)]="":i[decodeURIComponent(e.slice(0,r))]=decodeURIComponent(e.slice(r+1));return i}function m(t){return/[\/+]json($|[^-\w])/.test(t)}function y(t){this.req=t,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||void 0===this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var e=this.xhr.status;1223===e&&(e=204),this._setStatusProperties(e),this.header=this.headers=function(t){for(var e,r,i,n,s=t.split(/\r?\n/),o={},a=0,u=s.length;a<u;++a)-1!==(e=(r=s[a]).indexOf(":"))&&(i=r.slice(0,e).toLowerCase(),n=l(r.slice(e+1)),o[i]=n);return o}(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),null===this.text&&t._responseType?this.body=this.xhr.response:this.body="HEAD"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function _(t,e){var r=this;this._query=this._query||[],this.method=t,this.url=e,this.header={},this._header={},this.on("end",function(){var t,e=null,i=null;try{i=new y(r)}catch(t){return(e=new Error("Parser is unable to parse the response")).parse=!0,e.original=t,r.xhr?(e.rawResponse=void 0===r.xhr.responseType?r.xhr.responseText:r.xhr.response,e.status=r.xhr.status?r.xhr.status:null,e.statusCode=e.status):(e.rawResponse=null,e.status=null),r.callback(e)}r.emit("response",i);try{r._isResponseOK(i)||(t=new Error(i.statusText||"Unsuccessful HTTP response"))}catch(e){t=e}t?(t.original=e,t.response=i,t.status=i.status,r.callback(t,i)):r.callback(null,i)})}function v(t,e,r){var i=c("DELETE",t);return"function"==typeof e&&(r=e,e=null),e&&i.send(e),r&&i.end(r),i}c.serializeObject=p,c.parseString=f,c.types={html:"text/html",json:"application/json",xml:"text/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},c.serialize={"application/x-www-form-urlencoded":p,"application/json":JSON.stringify},c.parse={"application/x-www-form-urlencoded":f,"application/json":JSON.parse},a(y.prototype),y.prototype._parseBody=function(t){var e=c.parse[this.type];return this.req._parser?this.req._parser(this,t):(!e&&m(this.type)&&(e=c.parse["application/json"]),e&&t&&(t.length||t instanceof Object)?e(t):null)},y.prototype.toError=function(){var t=this.req,e=t.method,r=t.url,i="cannot "+e+" "+r+" ("+this.status+")",n=new Error(i);return n.status=this.status,n.method=e,n.url=r,n},c.Response=y,n(_.prototype),s(_.prototype),_.prototype.type=function(t){return this.set("Content-Type",c.types[t]||t),this},_.prototype.accept=function(t){return this.set("Accept",c.types[t]||t),this},_.prototype.auth=function(t,e,r){1===arguments.length&&(e=""),"object"==typeof e&&null!==e&&(r=e,e=""),r||(r={type:"function"==typeof btoa?"basic":"auto"});return this._auth(t,e,r,function(t){if("function"==typeof btoa)return btoa(t);throw new Error("Cannot use basic auth, btoa is not a function")})},_.prototype.query=function(t){return"string"!=typeof t&&(t=p(t)),t&&this._query.push(t),this},_.prototype.attach=function(t,e,r){if(e){if(this._data)throw Error("superagent can't mix .send() and .attach()");this._getFormData().append(t,e,r||e.name)}return this},_.prototype._getFormData=function(){return this._formData||(this._formData=new i.FormData),this._formData},_.prototype.callback=function(t,e){if(this._shouldRetry(t,e))return this._retry();var r=this._callback;this.clearTimeout(),t&&(this._maxRetries&&(t.retries=this._retries-1),this.emit("error",t)),r(t,e)},_.prototype.crossDomainError=function(){var t=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");t.crossDomain=!0,t.status=this.status,t.method=this.method,t.url=this.url,this.callback(t)},_.prototype.buffer=_.prototype.ca=_.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this},_.prototype.pipe=_.prototype.write=function(){throw Error("Streaming is not supported in browser version of superagent")},_.prototype._isHost=function(t){return t&&"object"==typeof t&&!Array.isArray(t)&&"[object Object]"!==Object.prototype.toString.call(t)},_.prototype.end=function(t){return this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=t||h,this._finalizeQueryString(),this._end()},_.prototype._end=function(){var t=this,e=this.xhr=c.getXHR(),r=this._formData||this._data;this._setTimeouts(),e.onreadystatechange=function(){var r=e.readyState;if(r>=2&&t._responseTimeoutTimer&&clearTimeout(t._responseTimeoutTimer),4==r){var i;try{i=e.status}catch(t){i=0}if(!i){if(t.timedout||t._aborted)return;return t.crossDomainError()}t.emit("end")}};var i=function(e,r){r.total>0&&(r.percent=r.loaded/r.total*100),r.direction=e,t.emit("progress",r)};if(this.hasListeners("progress"))try{e.onprogress=i.bind(null,"download"),e.upload&&(e.upload.onprogress=i.bind(null,"upload"))}catch(t){}try{this.username&&this.password?e.open(this.method,this.url,!0,this.username,this.password):e.open(this.method,this.url,!0)}catch(t){return this.callback(t)}if(this._withCredentials&&(e.withCredentials=!0),!this._formData&&"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof r&&!this._isHost(r)){var n=this._header["content-type"],s=this._serializer||c.serialize[n?n.split(";")[0]:""];!s&&m(n)&&(s=c.serialize["application/json"]),s&&(r=s(r))}for(var o in this.header)null!=this.header[o]&&this.header.hasOwnProperty(o)&&e.setRequestHeader(o,this.header[o]);return this._responseType&&(e.responseType=this._responseType),this.emit("request",this),e.send(void 0!==r?r:null),this},c.agent=function(){return new u},["GET","POST","OPTIONS","PATCH","PUT","DELETE"].forEach(function(t){u.prototype[t.toLowerCase()]=function(e,r){var i=new c.Request(t,e);return this._setDefaults(i),r&&i.end(r),i}}),u.prototype.del=u.prototype.delete,c.get=function(t,e,r){var i=c("GET",t);return"function"==typeof e&&(r=e,e=null),e&&i.query(e),r&&i.end(r),i},c.head=function(t,e,r){var i=c("HEAD",t);return"function"==typeof e&&(r=e,e=null),e&&i.query(e),r&&i.end(r),i},c.options=function(t,e,r){var i=c("OPTIONS",t);return"function"==typeof e&&(r=e,e=null),e&&i.send(e),r&&i.end(r),i},c.del=v,c.delete=v,c.patch=function(t,e,r){var i=c("PATCH",t);return"function"==typeof e&&(r=e,e=null),e&&i.send(e),r&&i.end(r),i},c.post=function(t,e,r){var i=c("POST",t);return"function"==typeof e&&(r=e,e=null),e&&i.send(e),r&&i.end(r),i},c.put=function(t,e,r){var i=c("PUT",t);return"function"==typeof e&&(r=e,e=null),e&&i.send(e),r&&i.end(r),i}},function(t,e,r){"use strict";t.exports=function(t){return null!==t&&"object"==typeof t}},function(t,e,r){var i=r(8);t.exports=function(t,e){return t.set("X-Requested-With","XMLHttpRequest"),t.set("Expires","-1"),t.set("Cache-Control","no-cache,no-store,must-revalidate,max-age=-1,private"),(i||e)&&function(t){var e=Date.now().toString();void 0!==t._query&&t._query[0]?t._query[0]+="&"+e:t._query=[e]}(t),t}},function(t,e,r){function i(t){if(t)return function(t){for(var e in i.prototype)t[e]=i.prototype[e];return t}(t)}t.exports=i,i.prototype.on=i.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},i.prototype.once=function(t,e){function r(){this.off(t,r),e.apply(this,arguments)}return r.fn=e,this.on(t,r),this},i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,i=this._callbacks["$"+t];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var n=0;n<i.length;n++)if((r=i[n])===e||r.fn===e){i.splice(n,1);break}return this},i.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),r=this._callbacks["$"+t];if(r)for(var i=0,n=(r=r.slice(0)).length;i<n;++i)r[i].apply(this,e);return this},i.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},i.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e,r){"use strict";var i=r(1);function n(t){if(t)return function(t){for(var e in n.prototype)t[e]=n.prototype[e];return t}(t)}t.exports=n,n.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,this},n.prototype.parse=function(t){return this._parser=t,this},n.prototype.responseType=function(t){return this._responseType=t,this},n.prototype.serialize=function(t){return this._serializer=t,this},n.prototype.timeout=function(t){if(!t||"object"!=typeof t)return this._timeout=t,this._responseTimeout=0,this;for(var e in t)switch(e){case"deadline":this._timeout=t.deadline;break;case"response":this._responseTimeout=t.response;break;default:console.warn("Unknown timeout option",e)}return this},n.prototype.retry=function(t,e){return 0!==arguments.length&&!0!==t||(t=1),t<=0&&(t=0),this._maxRetries=t,this._retries=0,this._retryCallback=e,this};var s=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];n.prototype._shouldRetry=function(t,e){if(!this._maxRetries||this._retries++>=this._maxRetries)return!1;if(this._retryCallback)try{var r=this._retryCallback(t,e);if(!0===r)return!0;if(!1===r)return!1}catch(t){console.error(t)}if(e&&e.status&&e.status>=500&&501!=e.status)return!0;if(t){if(t.code&&~s.indexOf(t.code))return!0;if(t.timeout&&"ECONNABORTED"==t.code)return!0;if(t.crossDomain)return!0}return!1},n.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this._end()},n.prototype.then=function(t,e){if(!this._fullfilledPromise){var r=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise(function(t,e){r.end(function(r,i){r?e(r):t(i)})})}return this._fullfilledPromise.then(t,e)},n.prototype.catch=function(t){return this.then(void 0,t)},n.prototype.use=function(t){return t(this),this},n.prototype.ok=function(t){if("function"!=typeof t)throw Error("Callback required");return this._okCallback=t,this},n.prototype._isResponseOK=function(t){return!!t&&(this._okCallback?this._okCallback(t):t.status>=200&&t.status<300)},n.prototype.get=function(t){return this._header[t.toLowerCase()]},n.prototype.getHeader=n.prototype.get,n.prototype.set=function(t,e){if(i(t)){for(var r in t)this.set(r,t[r]);return this}return this._header[t.toLowerCase()]=e,this.header[t]=e,this},n.prototype.unset=function(t){return delete this._header[t.toLowerCase()],delete this.header[t],this},n.prototype.field=function(t,e){if(null==t)throw new Error(".field(name, val) name can not be empty");if(this._data&&console.error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()"),i(t)){for(var r in t)this.field(r,t[r]);return this}if(Array.isArray(e)){for(var n in e)this.field(t,e[n]);return this}if(null==e)throw new Error(".field(name, val) val can not be empty");return"boolean"==typeof e&&(e=""+e),this._getFormData().append(t,e),this},n.prototype.abort=function(){return this._aborted?this:(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort"),this)},n.prototype._auth=function(t,e,r,i){switch(r.type){case"basic":this.set("Authorization","Basic "+i(t+":"+e));break;case"auto":this.username=t,this.password=e;break;case"bearer":this.set("Authorization","Bearer "+t)}return this},n.prototype.withCredentials=function(t){return null==t&&(t=!0),this._withCredentials=t,this},n.prototype.redirects=function(t){return this._maxRedirects=t,this},n.prototype.maxResponseSize=function(t){if("number"!=typeof t)throw TypeError("Invalid argument");return this._maxResponseSize=t,this},n.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},n.prototype.send=function(t){var e=i(t),r=this._header["content-type"];if(this._formData&&console.error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()"),e&&!this._data)Array.isArray(t)?this._data=[]:this._isHost(t)||(this._data={});else if(t&&this._data&&this._isHost(this._data))throw Error("Can't merge these send calls");if(e&&i(this._data))for(var n in t)this._data[n]=t[n];else"string"==typeof t?(r||this.type("form"),r=this._header["content-type"],this._data="application/x-www-form-urlencoded"==r?this._data?this._data+"&"+t:t:(this._data||"")+t):this._data=t;return!e||this._isHost(t)?this:(r||this.type("json"),this)},n.prototype.sortQuery=function(t){return this._sort=void 0===t||t,this},n.prototype._finalizeQueryString=function(){var t=this._query.join("&");if(t&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+t),this._query.length=0,this._sort){var e=this.url.indexOf("?");if(e>=0){var r=this.url.substring(e+1).split("&");"function"==typeof this._sort?r.sort(this._sort):r.sort(),this.url=this.url.substring(0,e)+"?"+r.join("&")}}},n.prototype._appendQueryString=function(){console.trace("Unsupported")},n.prototype._timeoutError=function(t,e,r){if(!this._aborted){var i=new Error(t+e+"ms exceeded");i.timeout=e,i.code="ECONNABORTED",i.errno=r,this.timedout=!0,this.abort(),this.callback(i)}},n.prototype._setTimeouts=function(){var t=this;this._timeout&&!this._timer&&(this._timer=setTimeout(function(){t._timeoutError("Timeout of ",t._timeout,"ETIME")},this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout(function(){t._timeoutError("Response timeout of ",t._responseTimeout,"ETIMEDOUT")},this._responseTimeout))}},function(t,e,r){"use strict";var i=r(6);function n(t){if(t)return function(t){for(var e in n.prototype)t[e]=n.prototype[e];return t}(t)}t.exports=n,n.prototype.get=function(t){return this.header[t.toLowerCase()]},n.prototype._setHeaderProperties=function(t){var e=t["content-type"]||"";this.type=i.type(e);var r=i.params(e);for(var n in r)this[n]=r[n];this.links={};try{t.link&&(this.links=i.parseLinks(t.link))}catch(t){}},n.prototype._setStatusProperties=function(t){var e=t/100|0;this.status=this.statusCode=t,this.statusType=e,this.info=1==e,this.ok=2==e,this.redirect=3==e,this.clientError=4==e,this.serverError=5==e,this.error=(4==e||5==e)&&this.toError(),this.created=201==t,this.accepted=202==t,this.noContent=204==t,this.badRequest=400==t,this.unauthorized=401==t,this.notAcceptable=406==t,this.forbidden=403==t,this.notFound=404==t,this.unprocessableEntity=422==t}},function(t,e,r){"use strict";e.type=function(t){return t.split(/ *; */).shift()},e.params=function(t){return t.split(/ *; */).reduce(function(t,e){var r=e.split(/ *= */),i=r.shift(),n=r.shift();return i&&n&&(t[i]=n),t},{})},e.parseLinks=function(t){return t.split(/ *, */).reduce(function(t,e){var r=e.split(/ *; */),i=r[0].slice(1,-1);return t[r[1].split(/ *= */)[1].slice(1,-1)]=i,t},{})},e.cleanHeader=function(t,e){return delete t["content-type"],delete t["content-length"],delete t["transfer-encoding"],delete t.host,e&&(delete t.authorization,delete t.cookie),t}},function(t,e){function r(){this._defaults=[]}["use","on","once","set","query","type","accept","auth","withCredentials","sortQuery","retry","ok","redirects","timeout","buffer","serialize","parse","ca","key","pfx","cert"].forEach(function(t){r.prototype[t]=function(){return this._defaults.push({fn:t,arguments:arguments}),this}}),r.prototype._setDefaults=function(t){this._defaults.forEach(function(e){t[e.fn].apply(t,e.arguments)})},t.exports=r},function(t,e){t.exports=function(){for(var t=3,e=document.createElement("b"),r=e.all||[];e.innerHTML="\x3c!--[if gt IE "+ ++t+"]><i><![endif]--\x3e",r[0];);return t>4?t:document.documentMode}()},function(t,e,r){"use strict";r.r(e);var i={};r.r(i),r.d(i,"note",function(){return B}),r.d(i,"phrase",function(){return R}),r.d(i,"pan",function(){return L}),r.d(i,"arpeggio",function(){return N}),r.d(i,"empty",function(){return S});var n={};r.r(n),r.d(n,"audioBufferLine",function(){return G}),r.d(n,"delayLine",function(){return U}),r.d(n,"pannerLine",function(){return F});const s=new(window.AudioContext||window.webkitAudioContext),o=(new Date).getTime(),a=(()=>{let t=window.navigator.userAgent;return["iPhone","iPad","iPod","Android"].some(e=>-1!==t.indexOf(e))?"low":"middle"})();var u={context:s,originTime:o,powerMode:a,toAudioBuffer:({src:t,length:e})=>!(!t||!e)&&new Promise((r,i)=>{try{let n=new ArrayBuffer(e),o=new Uint8Array(n);for(let r=0;r<e;r++)o[r]=t.charCodeAt(r);s.decodeAudioData(n,t=>t?r(t):i(),i)}catch(t){return i(t)}})};var h="https://api.ongaqjs.com";var c=new Map([["C",1],["C#",2],["Db",2],["D",3],["D#",4],["Eb",4],["E",5],["F",6],["F#",7],["Gb",7],["G",8],["G#",9],["Ab",9],["A",10],["A#",11],["Bb",11],["B",12]]);const l=/^([A-Z])+([1-4])+(b|#)?$/;var p=(t="")=>{if(!1===l.test(t))return t;{const e=l.exec(t);return e&&c.get(e[1])?`${e[2]}$${c.get(e[1]+(e[3]||""))}`:t}};var d=new Map([["kick","1$1"],["kick2","2$1"],["hihat","1$2"],["hihat2","2$2"],["snare","1$3"],["snare2","2$3"],["tom","1$4"],["tom2","2$4"],["side","1$9"],["side2","2$9"],["cymbal","1$12"],["cymbal2","2$12"]]),f=(t="")=>d.get(t)||t,m=r(0),y=r.n(m),_=r(2),v=r.n(_);let g=new Map;var b=new class{constructor(){this.soundNameMap=new Map}set({api_key:t}){this.api_key=t,y.a.get(`${h}/soundnamemap/`).then(t=>{if(!t||200!==t.body.statusCode)throw new Error("Cannot download instrumental master data.");this.soundNameMap=new Map(t.body.data)}).catch(()=>{throw new Error("Cannot download instrumental master data.")})}import(t){return new Promise((e,r)=>{if(g.get(t))return e();y.a.get(`${h}/sounds/`).query({sound:t,api_key:this.api_key}).set("Content-Type","application/json").use(v.a).then(i=>{let n=i.body.sounds[0];if(!n||"OK"!==n.status)return r();let s="string"==typeof n.data?JSON.parse(n.data):n.data,o=Object.keys(s.note),a=new Map,h=0;o.forEach(i=>{let n=s.note[i];u.toAudioBuffer({src:n.src,length:n.length}).then(r=>{a.set(i,r),++h===o.length&&(o=null,g.set(t,a),e())}).catch(()=>{g.has(t)&&g.delete(t),r()})})}).catch(()=>{g.has(t)&&g.delete(t),r(`Cannot load sound resources. There are 3 possible reasons: 1) [ ${t} ] is invalid instrumental name. 2) [ ${t} ] is not free and you don't have a pro license. 3) [ ${this.api_key} ] is not a valid API key.`)})})}ship({sound:t,key:e}){if(!t||!e||!g.get(t))return!1;const r=this.soundNameMap.get(t)&&this.soundNameMap.get(t).id;return r<2e4?e=p(e):r<3e4&&(e=f(e)),Array.isArray(e)?e.map(e=>g.get(t).get(e)).filter(t=>t):"string"==typeof e?[g.get(t).get(e)]:[]}};let w=new Float32Array(6);var T={toInt:(t,e={})=>{let r="number"==typeof e.max?e.max:Number.POSITIVE_INFINITY,i="number"==typeof e.min?e.min:Number.NEGATIVE_INFINITY,n="number"==typeof e.min?e.base:10,s=parseInt(t,n);return!Number.isNaN(s)&&s<=r&&s>=i&&s},getUUID:t=>{let e,r,i="";for(e=0;e<32;e++)r=16*Math.random()|0,8!=e&&12!=e&&16!=e&&20!=e||(i+="-"),i+=(12==e?4:16==e?3&r|8:r).toString(16);return"number"==typeof t&&(i=i.slice(0,t)),i},getWaveShapeArray:t=>{let e=t&&t>=0&&t<=1?t:1;return w[0]=1*e,w[1]=.8*e,w[2]=.5*e,w[3]=.3*e,w[4]=.1*e,w[5]=0,w},toKeyList:(t,e,r)=>!!t&&(Array.isArray(t)?t:Array.isArray(t.list)?t.list:"function"==typeof t?e>=0&&t(e,r):"string"==typeof t&&[t]),toLength:(t,e,r)=>{switch(typeof t){case"number":return t;case"function":return e>=0&&t(e,r);default:return!1}}};var x={BPM:120,MIN_BPM:60,MAX_BPM:180,MEASURE:1,VOLUME:.5,NOTES_IN_MEASURE:16,PREFETCH_SECOND:"middle"===u.powerMode?.3:2};var E=new Map([["",[4,3]],["M7",[4,3,4]],["7",[4,3,3]],["m",[3,4]],["m7",[3,4,3]],["mM7",[3,4,4]],["6",[4,3,2]],["m6",[3,4,2]],["dim",[3,3,3]],["aug",[4,4]],["sus4",[5,2]],["7sus4",[5,2,3]],["7-5",[4,2,4]],["m7-5",[3,3,4]],["M7+5",[4,4,3]],["M9",[4,3,4,3]],["m9",[3,4,3,4]],["m11",[3,4,3,7]],["6(9)",[4,3,2,5]],["m6(9)",[3,4,2,5]],["7(b9)",[4,3,3,3]],["9",[4,3,3,4]],["7(9)",[4,3,3,4]],["7(#9)",[4,3,3,5]],["11",[4,3,3,7]],["7(#11)",[4,3,3,8]],["13",[4,3,3,11]],["7(13)",[4,3,3,11]]]),A="0.1.0";const k=u.context;var P=class{constructor(t){this._init(t)}add(t){return new Promise((e,r)=>{if("function"!=typeof t._loadSound)return r("not a Part object");t.bpm=t.bpm||this.bpm,t._beatsInMeasure=t._beatsInMeasure||x.NOTES_IN_MEASURE,t.measure=t.measure||x.MEASURE,this.parts.set(t.id,t),t._loadSound().then(()=>{let t=!0;return this.parts.forEach(e=>{(e._isLoading||e._loadingFailed)&&(t=!1)}),t&&this.onReady&&this.onReady(),e()}).catch(r)})}start(){if(this.isPlaying||0===this.parts.size)return!1;this.isPlaying=!0,this._prepareCommonGain(),this.parts.forEach(t=>{t._putTimerRight(k.currentTime)});let t=[];return this.parts.forEach(e=>t.push(e.measure)),this.parts.forEach(t=>{t._setQuota(1/0)}),this._scheduler=window.setInterval(this._routine,"middle"===u.powerMode?50:200),!1}pause(){return!!this.isPlaying&&(this._scheduler&&(window.clearInterval(this._scheduler),this._scheduler=null),this.isPlaying=!1,this._removeCommonGain(),!1)}find(...t){let e=void 0;return 0===t.length?e:(this.parts.forEach(r=>{t.every(t=>r.tags.include(t))&&(e=e||[]).push(r)}),e)}get params(){let t=!1;return this.parts.forEach(e=>{e._isLoading&&(t=!0)}),{loading:t,isPlaying:this.isPlaying,originTime:u.originTime,currentTime:k.currentTime,volume:this.volume}}get constants(){return{DRUM_NOTE:d,ROOT:c,SCHEME:E}}get version(){return A}set volume(t){if("number"!=typeof t||t<0||t>100)return!1;t>0&&(this._previousVolume=this._volume),this._volume=t/100,this.commonGain&&this.commonGain.gain.setValueAtTime(this._volume,k.currentTime+.01)}get volume(){return 100*this._volume}set bpm(t){let e=T.toInt(t,{max:x.MAX_BPM,min:x.MIN_BPM});if(!e)return!1;this._bpm=e,this.parts.forEach(t=>{t.bpm=e})}get bpm(){return this._bpm}_init({api_key:t,volume:e,bpm:r,onReady:i}){this.parts=new Map,this.isPlaying=!1,this.volume=e||x.VOLUME,this._previousVolume=this.volume,this._nextZeroTime=0,this.bpm=r||x.BPM,"low"===u.powerMode&&window.addEventListener("blur",()=>{this.pauseScheduling()}),this.onReady="function"==typeof i&&i,this._routine=this._routine.bind(this),b.set({api_key:t})}_prepareCommonGain(){if(this.commonGain)return!1;this.commonComp||(this.commonComp=k.createDynamicsCompressor(),this.commonComp.connect(k.destination)),this.commonGain=k.createGain(),this.commonGain.connect(this.commonComp),this.commonGain.gain.setValueAtTime(this._previousVolume||this.volume,0)}_removeCommonGain(){return!!this.commonGain&&(this.commonGain.gain.setValueAtTime(0,0),this.commonGain=null,!1)}_connect(t){return!(!t||!this.isPlaying||(t.connect(this.commonGain).start(),t=null,1))}_routine(){let t,e;if(this.parts.forEach(r=>{(e=r._observe())&&e.length>0&&(t=(t=t||[]).concat(e))}),!t||0===t.length)return!1;t.forEach(t=>{t.layer&&t.layer.length>0&&this._connect(t)})}};var C=(t,e)=>{if(0===t||t<=-13||t>=13)return e;if(!Array.isArray(e))return[];let r=e.map(t=>t.split("$").map(t=>+t));return r=r.map(e=>e[1]+t<=12&&e[1]+t>0?`${e[0]}$${e[1]+t}`:t<0&&e[1]+t<=0?e[0]>1&&`${e[0]-1}$${12+e[1]+t}`:t>0&&e[1]+t>12&&(e[0]<4?`${e[0]+1}$${-12+e[1]+t}`:void 0)).filter(t=>t)};class M{constructor(t,e={}){this._init(t,e)}shift(t){return new M(this.name,{octave:this.defaultOctave,key:C(t,this.originalKey)})}octave(t){if(0===t||"number"!=typeof t||Number.isNaN(t))return this;let e=this.originalKey.map(t=>t.split("$").map(t=>+t));return e=e.map(e=>{if(e[0]+t<=4&&e[0]+t>0)return`${e[0]+t}$${e[1]}`}).filter(t=>t),new M(this.name,{octave:this.defaultOctave,key:e})}reverse(){let t=this.originalKey.reverse();return new M(this.name,{octave:this.defaultOctave,key:t})}slice(t,e){if(Number.isNaN(t))return this;let r=this.originalKey.slice(t,e);return new M(this.name,{octave:this.defaultOctave,key:r})}rotate(){if(!this.key)return this;let t=this.originalKey.map(t=>t),e=t.splice(-1,1)[0],r=t.splice(0,1)[0],i=e.split("$").map(t=>+t),n=r.split("$").map(t=>+t),s=n[1],o=(()=>n[1]>i[1]?i[0]:n[1]+i[1]>12?i[0]+1:i[0])();if(o>4)return this;let a=this.key.map(t=>t).splice(1);return a.push(`${o}$${s}`),new M(this.name,{octave:this.defaultOctave,key:a})}get route(){return Array.isArray(this.key)&&this.key[0]}get name(){return this.rootLabel+this.schemeLabel}_init(t,e){if(this.active=!0,this.defaultShift=e.defaultShift||0,this.defaultOctave=e.octave>0&&e.octave<=4?e.octave:2,"string"!=typeof t)return this.active=!1,!1;let r=(()=>{let e,r,i=[];return c.forEach((n,s)=>{(i=t.match(new RegExp("^"+s)))&&i[0]===s&&(e=n,r=s)}),{root:e,rootLabel:r}})();if(!r.root)return this.active=!1,!1;let i=(t=>{let e,r;return E.forEach((i,n)=>{n===t&&(e=i,r=n)}),{scheme:e,schemeLabel:r}})(t.replace(r.rootLabel,""));if(!i.scheme)return this.active=!1,!1;let n=(()=>{if(e.key)return e.key;let t=[],n=r.root,s=this.defaultOctave;return t.push(`${s}$${n}`),i.scheme.forEach(e=>{let r=n+e>12;n=r?n+e-12:n+e,(s=r?s+1:s)<=4&&t.push(`${s}$${n}`)}),t})();this.rootLabel=r.rootLabel,this.defaultOctave=e.octave,this.scheme=i.scheme,this.schemeLabel=i.schemeLabel,this.originalKey=C(this.defaultShift,n.map(t=>t)),this.key=C(this.defaultShift,n)}}var O=M;const I=4;var B=(t={},e={})=>{let r=(t=>{let r;switch(typeof t){case"string":return[t];case"function":return!!(r=t(e.beatIndex,e.measure))&&(Array.isArray(r)?r:"object"==typeof r?Array.isArray(r)?r:r.key:"string"==typeof r&&[r]);case"object":return Array.isArray(t)?t:t.key;default:return!1}})(t.key);if(!r)return!1;let i=(()=>{if(!t.length)return I;switch(typeof t.length){case"number":return t.length;case"function":return t.length(e.beatIndex,e.measure);default:return!1}})();return!!i&&r.map(r=>({invoker:"audioBufferLine",data:{buffer:{sound:e.sound,length:i*e._secondsPerBeat,key:r,startTime:e.beatTime},volume:t.volume>=0&&t.volume<=100?t.volume/100:null}}))};var R=(t={},e={})=>{if(!Array.isArray(t.path)||0===t.path.length)return!1;let r,i,n=0,s=[];return t.path.forEach(o=>!(o.length<2)&&(o[1]>0&&(n+=o[1]),r=T.toKeyList(o[0],e.beatIndex,e.measure),i=T.toLength(o[1],e.beatIndex,e.measure),!(!r||!i)&&void r.forEach(r=>{s.push({invoker:"audioBufferLine",data:{buffer:{sound:e.sound,length:o[1]*e._secondsPerBeat,key:r,startTime:e.beatTime+n*e._secondsPerBeat},volume:o[2]>=0&&o[2]<=1?o[2]:t.volume>=0&&t.volume<=100?t.volume/100:null}})}))),s};var L=(t={},e={})=>{let r=[],i=(()=>{if(0===e.layer.length)return!1;for(let t=e.layer.length-1,r=0;t>=r;t--)if("audioBufferLine"===e.layer[t][0].invoker)return e.layer[t];return!1})();if(!i)return!1;let n=(t=>{switch(typeof t){case"string":case"number":return T.toInt(t,{max:90,min:-90})/30;case"function":return T.toInt(t(e.beatIndex),{max:90,min:-90})/30;default:return 0}})(t.x);return 0!==n&&(i.forEach((t,e)=>{r.push({invoker:"pannerLine",data:{positionX:n,targetIndex:e}})}),r)};var N=(t={},e={})=>{let r=[],i=(()=>{if(0===e.layer.length)return!1;for(let t=e.layer.length-1,r=0;t>=r;t--)if("audioBufferLine"===e.layer[t][0].invoker)return e.layer[t];return!1})();if(!i)return!1;let n="number"==typeof t.step&&t.step<16?t.step:1;return i.forEach((t,i)=>{r.push({invoker:"delayLine",data:{delayTime:e._secondsPerBeat*(i<=3?i:3)*n,targetIndex:i}})}),r};var S=(()=>()=>!1).call(void 0,window||{});let $={required:0,retrived:0,recycled:0};var q=class{constructor(t){this.x=u.context,this.name=t.name,this.isClass=t.isClass,this.active=!1!==t.active,this.makeMethod=t.makeMethod,this.make=(t=>this.isClass?new this.makeMethod(t):this.makeMethod(t)),this.pool=[],this.metrics={required:0,retrived:0,recycled:0}}allocate(t){let e=void 0;return $.required++,this.metrics.required++,0===this.pool.length||!1===this.active?e=this.make(t):(e=this.pool.pop())?($.recycled++,this.metrics.recycled++):e=this.make(t),e}retrieve(t){this.pool.push(t),$.retrived++,this.metrics.retrived++}flush(){this.pool=[]}};const D=u.context;var j=class{constructor(t={}){this.init(t)}init(t){this.audioBufferNode=t.audioBufferNode instanceof AudioNode&&t.audioBufferNode,this.gainNode=t.gainNode instanceof GainNode?t.gainNode:(t=>(t.gain.setValueAtTime(1,0),t))(D.createGain()),this.output=t.output||this.gainNode,this.name=t.name,this.loader="function"==typeof t.loader?t.loader:null,this.starter="function"==typeof t.starter?t.starter:null}};const H=u.context;var G=({buffer:t,volume:e})=>{let r=b.ship(t);if(!r)return!1;let i=H.createBufferSource();i.length=t.length,i.buffer=r[0],i.startTime=t.startTime||H.currentTime;let n=H.createGain();return n.gain.setValueAtTime(e&&e>=0&&e<1?e:1,0),n.gain.setValueCurveAtTime(T.getWaveShapeArray(e),t.startTime+t.length-.02,.02),i.connect(n),new j({name:"audioBufferLine",audioBufferNode:i,gainNode:n,loader:(t,e)=>{t[e]&&n.connect(t[e].output)},starter:()=>{i.start(i.startTime)}})};const X=u.context;var U=({delayTime:t,targetIndex:e})=>{let r=X.createDelay();return r.delayTime.value=t,new j({name:"delayLine",delayNode:r,loader:(t,i)=>{if(0===i||!t[i-1])return!1;t[i-1]&&t[i-1].instance[e].output&&t[i-1].instance[e].output.connect(r),t[i]&&r.connect(t[i].output)},starter:null})};const V=u.context;var F=(({innerWidth:t,innerHeight:e})=>{let r=t,i=e,n=V.listener;return n.forwardX?(n.forwardX.setValueAtTime(0,V.currentTime),n.forwardY.setValueAtTime(0,V.currentTime),n.forwardZ.setValueAtTime(-1,V.currentTime),n.upX.setValueAtTime(0,V.currentTime),n.upY.setValueAtTime(1,V.currentTime),n.upZ.setValueAtTime(0,V.currentTime)):n.setOrientation(0,0,-1,0,1,0),n.positionX?(n.positionX.value=r/2,n.positionY.value=i/2,n.positionZ.value=200):n.setPosition(r/2,i/2,200),t=>{if(t.targetIndex>0)return!1;const e=V.createPanner(),n=[1,0,0];e.orientationX?(e.orientationX.setValueAtTime(n[0],V.currentTime),e.orientationY.setValueAtTime(n[1],V.currentTime),e.orientationZ.setValueAtTime(n[2],V.currentTime)):e.setOrientation(...n);let s=(t=>"number"==typeof t&&t>=-90&&t<=90?t:0)(t.positionX);const o=[r/2+s,i/2,200];return e.positionX?(e.positionX.setValueAtTime(o[0],V.currentTime),e.positionY.setValueAtTime(o[1],V.currentTime),e.positionZ.setValueAtTime(o[2],V.currentTime)):e.setPosition(...o),new j({name:"pannerLine",loader:(t,r)=>{if(0===r||!t[r-1])return!1;t[r-1].output.connect(e),t[r]&&e.connect(t[r].output)},starter:null})}}).call(null,window);const z=u.context;var K=new q({makeMethod:class{constructor(t){this.init(t)}init(t){this.graph=t,this.output=z.createGain(),this._secondsPerBeat=t._secondsPerBeat,this.layer=this.invokeAll()}invokeAll(){if(!Array.isArray(this.graph.layer))return!1;let t=new Array(this.graph.layer.length);this.graph.layer.forEach((e,r)=>{let i=e.map(e=>e.invoker in n&&n[e.invoker](e.data,r>0&&t[r-1])).filter(t=>t);i.length>0&&(t[r]={name:i[0].name,loader:(t,e)=>{i.forEach(r=>r.loader&&r.loader(t,e))},starter:()=>{i.forEach(t=>t.starter&&t.starter())},output:z.createGain(),instance:i})});for(let e=0,r=(t=t.filter(t=>t)).length;e<r;e++)t[e].loader(t,e),"audioBufferLine"===t[e].name&&t[e].output.connect(this.output);return t}connect(t){return this.output&&this.output.connect(t),this}start(){return!!this.startAble&&(this.layer.forEach(t=>t.starter()),this)}get startAble(){return this.layer&&this.layer[0]&&"function"==typeof this.layer[0].loader}},active:!0,isClass:!0,name:"SoundTree"});var Q=new q({makeMethod:class{constructor(t){this.sound=t.sound,this.measure=t.measure,this.beatIndex=t.beatIndex,this.beatTime=t.beatTime,this._secondsPerBeat=t._secondsPerBeat,this.age=t.age,this.layer=[]}note(t={}){return this.develop("note",t)}pan(t={}){return this.develop("pan",t)}arpeggio(t={}){return this.develop("arpeggio",t)}empty(t={}){return this.develop("empty",t)}phrase(t={}){return this.develop("phrase",t)}pass(t){switch(typeof t){case"function":return t(this.beatIndex,this.measure);case"object":return Array.isArray(t)&&t.includes(this.beatIndex);case"number":return t===this.beatIndex;default:return!0}}develop(t,e){if(!this.pass(e.active))return this;let r=i[t](e,this);return r&&this.layer.push(r),this}},active:!0,isClass:!0,name:"Graph"});const Y=u.context;var Z=class{constructor(t,e={}){this.sound=t.sound,this.handler=e,this.id=t.id||T.getUUID(),this.tags=Array.isArray(t.tags)?t.tags:[],this.bpm=t.bpm,this.measure=t.measure,this._isLoading=!1,this._beatsInMeasure=t._beatsInMeasure,this._currentBeatIndex=0,this._nextBeatTime=0,this._age=0,this._beatQuota=0,this._consumedBeats=0,this.attachment={},this.active=!1,this.mute=!!t.mute,this._putTimerRight(),this._observe=this._observe.bind(this)}add(t){if(!t)return!1;this.filters=this.filters||[],this.filters.push(t),this._generator=(t=>this.filters.reduce((t,e)=>Object.hasOwnProperty.call(i,e.type)?t[e.type](e.params):t,t)),this._generator=this._generator.bind(this)}attach(t={}){this._attachment=Object.assign(this._attachment,t)}detach(t){"string"==typeof t?delete this._attachment[t]:this._attachment={}}tag(...t){this.tags=Array.isArray(this.tags)?this.tags:[],t.forEach(t=>{this.tags.includes(t)||this.tags.push(t)})}set mute(t){"boolean"==typeof t&&(this._mute=t)}get mute(){return this._mute}set bpm(t){let e=T.toInt(t,{max:x.MAX_BPM,min:x.MIN_BPM});e&&(this._bpm=e)}get bpm(){return this._bpm}_loadSound(){return this._isLoading=!0,new Promise((t,e)=>{b.import(this.sound).then(()=>{this._isLoading=!1,this.active=!0,t()}).catch(t=>{this._isLoading=!1,this._loadingFailed=!0,e(t)})})}_reset(){this._age=0,this._currentBeatIndex=0,this._consumedBeats=0,this._beatQuota=0}_putTimerRight(t){this._nextBeatTime=t||Y.currentTime}_setQuota(t){this._beatQuota=t*this._beatsInMeasure,this.active=!0}_observe(){let t,e=Y.currentTime+x.PREFETCH_SECOND;for(;this._nextBeatTime-e>0&&this._nextBeatTime-e<x.PREFETCH_SECOND;)e+=x.PREFETCH_SECOND;for(;this.active&&this._nextBeatTime<e&&!(this._consumedBeats>=this._beatQuota);){let e=!this.mute&&this._capture();if(e&&e.layer.length>0&&(t=(t=t||[]).concat(e)),this._nextBeatTime+=this._secondsPerBeat,this._currentBeatIndex+1>=this.measure*this._beatsInMeasure?(this._currentBeatIndex=0,this._age++):this._currentBeatIndex++,++this._consumedBeats>=this._beatQuota){this.active=!1;break}}return t}_capture(){return!!this._generator&&(this._currentGraph=this._generator(Q.allocate({sound:this.sound,measure:Math.floor(this._currentBeatIndex/this._beatsInMeasure),beatIndex:this._currentBeatIndex%this._beatsInMeasure,beatTime:this._nextBeatTime,_secondsPerBeat:this._secondsPerBeat,age:this._age,attachment:this._attachment})),this._currentSoundTree=K.allocate(this._currentGraph),this._currentSoundTree.layer.length>0&&this._currentSoundTree)}get _secondsPerBeat(){return 60/this._bpm/8}};var W=class{constructor(t){this.init(t)}init(t={type:null}){this.type="string"==typeof t.type?t.type:"note",this.params=t,delete t.type}};window.Ongaq=window.Ongaq||P,window.Chord=window.Chord||O,window.Part=window.Part||Z,window.Filter=window.Filter||W;e.default={Ongaq:P,Chord:O,Part:Z,Filter:W}}]);